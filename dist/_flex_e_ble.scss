////
/// @group Variables
////


/// Used as class flag to enable flexbox properties
/// Must be added to html tag either manaully or feature detect eg modernizr
/// @name flexbox-enable-class
/// @default {string} 'flexbox'
$flexbox-enable-class: 'flexbox' !default;

/// Used to flag if flexbox compatibility
/// @name flexbox-compatibility-enabled
/// @default true
$flexbox-compatibility-enabled: true !default;

/// Used to help define the whitespace between grid items
/// @name special-font-stack
$special-font-stack: Helvetica, Arial, sans-serif !default;

/// The default grid item text-align reset
/// @name default-text-align
$default-text-align: left !default;

$starting-columns: 1 !default;
$total-columns: 12 !default;

$column-gutter: 15px !default;
$auto-column-gutters: false !default;
$grid-padding-name: 'pad' !default;
$independant-grid-name: '' !default;

/// Use to namespace the whole grid-system.
/// @name global-name-space
/// @examples 'wtf-' or 'cool-'
$global-name-space: '' !default;
/// Wrapper name to create a centering div.
/// Uses margin-left: auto; margin-right: auto
/// @name container-name
$container-name: 'container' !default;
$grid-name: 'grid-' !default; // Could be col or column
$base-grid-name: '' !default; // Does your base grid have a sufix.
$row-name: 'row' !default; // Could be flex
$disable-push-pull-classes: false !default;
$right-name: 'right' !default; // Could be push
$left-name: 'left' !default; // Could be push

// Set to true to always set column index after grid name eg. grid-1-md instead of grid-md-1
$column-index-always-before-size: false !default;

/// The include-media breakpoints.
/// Loop over these breakpoints and pass keys into grid classes
/// @name breakpoints

$breakpoints: (
  'small': 480px,
  'medium': 768px,
  'large': 1024px,
  'xlarge': 1180px
) !default;

/// The default include-media breakpoint direction
/// @name break-dir
/// @example '<'
$break-dir: '>=' !default;

$smallest-size: nth(map-values($breakpoints), 1);
$last-breakpoint: nth(map-values($breakpoints), length($breakpoints));


/// Sets the max-width of the container class
/// @name container-max-width
$container-max-width: $last-breakpoint !default;

/// Sets the max-width of the container class
/// @name container-max-width
/// @deprecated Deprecation for the more appropriate named $container-max-width
$container-breakpoint: $container-max-width !default;

/// Sets the breakpoint of the gutters of when they half in size
/// @name column-gutter-breakpoint
$column-gutter-breakpoint: $smallest-size !default;

$enable-extra-grid: false !default;
$extra-grid-name: 'fifth' !default;
$extra-columns: 5 !default;

$grid-framework: '' !default;

@if $grid-framework == 'bootstrap' {
  $grid-name: 'col-';
  $base-grid-name: 'xs';
  $column-gutter: 15px;
  $auto-column-gutters: true;
  $right-name: 'push';
  $left-name: 'pull';
  $breakpoints: (
    'sm': 480px,
    'md': 768px,
    'lg': 1024px,
    'xl': 1180px
  );

}

@if $grid-framework == 'foundation' {
  $column-gutter: 0.9375rem;
  $auto-column-gutters: false;
  $independant-grid-name: 'column';
  $grid-name: '';
  $base-grid-name: 'small';
  $breakpoints: (
    'medium': 768px,
    'large': 1024px
  );
}

@function grid-size($n) {
  @return percentage($n / $total-columns);
}

@function grid-size-special($n) {
  @return percentage($n / $extra-columns);
}

@function has-dash($string) {
  $has-dash: $string + ''; // allow numbers
  @if $has-dash == '' { @return true; } // return itself if blank
  @return str-index($has-dash, '-') != null;
}

// check for dash else add one
@function dashize($string, $position: 'end') {
  $dashized: $string;

  @if has-dash($string) { @return $dashized; }
  @if ($position == 'start') {
    @return '-' + $dashized;
  }
  @return $dashized + '-';
}

@function master-grid-name() {
  $master-grid-name: $grid-name;

  // replace $grid-name with $independant-grid-name if available
  @if $independant-grid-name != '' { $master-grid-name: $independant-grid-name; }

  @return $global-name-space + $master-grid-name;
}

@function base-grid() {
  @return $global-name-space + dashize($grid-name);
}

@function grid-name-order($size-name, $increment) {
  @if ($column-index-always-before-size) {
    @return $increment + dashize($size-name, 'start');
  } @else {
    @return dashize($size-name) + $increment;
  }
}

@function offset-name-order($offset-name, $size-name, $increment) {
  @if ($column-index-always-before-size) {
    @return $increment + dashize($offset-name, 'start') + dashize($size-name, 'start');
  } @else {
    @return dashize($size-name) + $offset-name + '-' + $increment;
  }
}

@function grid-name($increment, $size-name: $base-grid-name) {
  @return base-grid() + grid-name-order($size-name, $increment);
}

@function offset-right-name($increment, $size-name: $base-grid-name) {
  @return base-grid() + offset-name-order($right-name, $size-name, $increment);
}

@function offset-left-name($increment, $size-name: $base-grid-name) {
  @return base-grid() + offset-name-order($left-name, $size-name, $increment);
}

/// Defines a row with display flex - falls back to display block.
/// Uses negetive letter spacing to remove white space from children
/// @name build-row
/// @requires disable-if-flexbox-pure
/// @requires flexbox-enabled-class
/// @param {string} $display [block] - fallback if flex is not compatible
/// @group Core Grid

@mixin build-row($display: block) {

  @include disable-if-flexbox-pure {
    display: $display;
  }

  @include flexbox-enabled-class {
    display: flex;
    flex-flow: row wrap;
  }

  position: relative;
  letter-spacing: -0.31em; // Webkit: collapse white-space between units
  text-rendering: optimizespeed; // Webkit: fixes text-rendering: optimizeLegibility
  box-sizing: border-box;
}


/// Defines a grid item
/// and resets letter spacing between children
/// @name build-grid
/// @require special-font-stack [Helvetica, Arial, sans-serif]
/// @require default-text-align [left]
/// @group Core Grid

@mixin build-grid {
  display: inline-block;
  position: relative;

  font-family: $special-font-stack;
  letter-spacing: normal;
  text-align: $default-text-align;
  text-rendering: auto;
  vertical-align: top;

  box-sizing: border-box;
}

/// Build a gutter
/// and resets letter spacing between children
/// @name build-column-gutter
/// @require column-gutter-breakpoint [smallest size of breakpoints ]
/// @require break-dir ['>=']
/// @group Core Grid

@mixin build-column-gutter {

  padding-right: ($column-gutter / 2);
  padding-left: ($column-gutter / 2);


  @include media('#{$break-dir + $column-gutter-breakpoint}') {
    padding-right: ($column-gutter);
    padding-left: ($column-gutter);
  }
}

/// Used to cleanup unwanted properties if flexbox fallback is not required
/// @name disable-if-flexbox-pure
/// @require flexbox-compatibility-enabled [true]
/// @group Helpers
@mixin disable-if-flexbox-pure {
  @if $flexbox-compatibility-enabled {
    @content;
  }
}

///
/// @name flexbox-enabled-class
/// @require $flexbox-enable-class [true]
/// @group Helpers
@mixin flexbox-enabled-class {
  @if $flexbox-enable-class != '' {
    .#{$flexbox-enable-class} & {
      @content;
    }
  } @else {
    @content;
  }
}

///
/// @name flexbox-enabled-class
/// @require $container-max-width [true]
/// @require $break-dir ['>=']
/// @group Helpers
@mixin build-container {
  margin-right: auto;
  margin-left: auto;

  @include media('#{$break-dir + $container-max-width}') {
    max-width: $container-max-width;
  }
}

html {
  font-family: $special-font-stack;
}

.#{$global-name-space + $container-name} {
  @include build-container;
}

.#{$global-name-space + $row-name} {
  @include build-row;

  @include disable-if-flexbox-pure {
    width: 100%;
  }

  @include flexbox-enabled-class {
    // clearfix breaks flexgrid row
    &.clearfix {
      &:before,
      &:after {
        content: initial;
      }
    }
  }
}

.#{$global-name-space + $grid-padding-name} {
  @include build-column-gutter;
}

[class*='#{master-grid-name()}'] {
  @include build-grid;

  @if $auto-column-gutters {
    @include build-column-gutter;
  }

  &.row {
    @include build-row($display: inline-block);
  }
}


@for $i from $starting-columns through $total-columns {
  $local-size: grid-size($i);

  // Base grid
  .#{grid-name($i)} {
    width: $local-size;
  }

  @if not $disable-push-pull-classes {
    // Offset right
    .#{offset-right-name($i)} {
      right: auto;
      left: $local-size;
    }

    // Offset left
    .#{offset-left-name($i)} {
      right: $local-size;
      left: auto;
    }
  }
}

@each $size, $breakpoint in $breakpoints {
  @include media('#{$break-dir + $breakpoint}') {
    @for $i from $starting-columns through $total-columns {
      $local-size: grid-size($i);

      // Responsive Grid
      .#{grid-name($i, $size)} {
        width: $local-size;
      }

      @if not $disable-push-pull-classes {
        // Responsive offset right
        .#{offset-right-name($i, $size)} {
          right: auto;
          left: $local-size;
        }

        // Responsive offset left
        .#{offset-left-name($i, $size) } {
          right: $local-size;
          left: auto;
        }
      }
    }
  }
}


@if $enable-extra-grid {
  @for $i from $starting-columns through $extra-columns {
    .#{$global-name-space + $extra-grid-name + $i} {
      width: grid-size-special($i);
    }
  }


  @each $size, $breakpoint in $breakpoints {
    @include media('#{$break-dir + $breakpoint}') {
      @for $i from $starting-columns through $extra-columns {
        .#{$global-name-space + $extra-grid-name + $size + '-' + $i} {
          width: grid-size-special($i);
        }
      }
    }
  }
}

.#{master-grid-name()} {

  &bottom {
    vertical-align: bottom !important;
  }

  &middle {
    vertical-align: middle !important;
  }

  @include flexbox-enabled-class {
    &grow {
      flex-grow: 1 !important;
    }

    &top {
      align-self: flex-start !important;
    }

    &middle {
      align-self: center !important;
    }

    &bottom {
      align-self: flex-end !important;
    }

    &base {
      align-self: baseline !important;
    }

    &stretch {
      align-self: stretch !important;
    }
  }
}

.#{$global-name-space + $row-name} {

  &-column {
    flex-flow: column wrap !important;
  }

  &-reverse {
    direction: rtl !important;
  }

  &-right {
    @include disable-if-flexbox-pure {
      text-align: right !important;
    }
    @include flexbox-enabled-class {
      justify-content: flex-end !important;
      text-align: inherit !important;
    }
  }

  &-center {
    @include disable-if-flexbox-pure {
      text-align: center !important;
    }
    @include flexbox-enabled-class {
      justify-content: center !important;
      text-align: inherit !important;
    }
  }

  &-left {
    @include disable-if-flexbox-pure {
      text-align: left !important;
    }
    @include flexbox-enabled-class {
      justify-content: flex-start !important;
      text-align: inherit !important;
    }
  }


  // ordering of items flow
  @include flexbox-enabled-class {

    &-top {
      align-items: flex-start !important;
    }

    &-middle {
      align-items: center !important;
    }

    &-bottom {
      align-items: flex-end !important;
    }

    &-base {
      align-items: baseline !important;
    }

    &-stretch {
      align-items: stretch !important;
    }

    &-between {
      justify-content: space-between !important;
    }

    &-around {
      justify-content: space-around !important;
    }
  }
}
